#!/bin/bash

# DWIM: Derive the feature name from the current branch.
if [ $# -eq 0 ] && \
    branchName="$(git brname --real-branch-only 2>/dev/null)" && \
    featureName="${branchName#feature/}"
then
    if [ "$featureName" = "$branchName" ]; then
	printf >&2 'ERROR: Not on a feature branch: %s\n' "$branchName"
	exit 1
    else
	set -- "$featureName"
    fi
fi

# Ensure that the branch is good for merging.
if targetBranch="$(git config --local --get gitflow.branch.develop)"; then
    git-mergecheck --merge-to "$targetBranch" || exit $?
fi

exec git flow feature finish "$@"
