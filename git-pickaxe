#!/bin/bash

printUsage()
{
    cat <<HELPTEXT
Pickaxe: Show log (and commits with -p) where text or /regexp/ was changed.
HELPTEXT
    printf 'Usage: %q %s\n' "$(basename "$1")" '[<options>] [<since>..<until>] [[--] <path>...] text|/regexp/ [-?|-h|--help]'
}
case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
esac

typeset arg=
typeset -a allargs=()
for arg
do
    # The last argument is the text or /regexp/.
    [ $# -le 1 ] && break

    # All other arguments are forwarded to "git log".
    allargs+=("$arg")
    shift
done

typeset searchString=$(echo "$1" | sed -ne 's/^\([^a-zA-Z0-9]\)\(.*\)\1$/\2/p')
[ "$searchString" ] && allargs+=("--pickaxe-regex") || searchString=$1

exec git log "${allargs[@]}" "-S$searchString"
